<!DOCTYPE html>
<html lang="">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous"> <link
  rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous"> <link
  rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous"> <link rel="preload"
  href="/lib/Krub/Krub-SemiBold.woff2" as="font"
  type="font/woff2" crossorigin="anonymous">
  <script
    type="text/javascript"
    src="https://latest.cactus.chat/cactus.js"
  ></script>
  <link
    rel="stylesheet"
    href="https://latest.cactus.chat/style.css"
    type="text/css"
  />
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> Concurrency using Actor | Aaron Phan</title>
  <link rel="canonical" href="https://tinhpv.github.io/posts/ios/concurrency-with-actor-swift/" />
  
  <meta name="description" content="Hello there!

My name is Phan Vũ-Tinh, can call me Aaron. I’m a Vietnamese mobile engineer, working mostly on iOS app native development. Besides, I’m also a runner, a travel enthusiast, a bookworm, a pluviophile, and ... a superhero movie die-hard fan :)

I’m passionate about learning new things, deciphering challenging problems, breaking impasses, and creating delightful experiences.

This blog was made to learn and to share." />
  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="all,follow" />
  <meta name="googlebot" content="index,follow,snippet,archive" />
  <meta property="og:title" content="Concurrency using Actor" />
<meta property="og:description" content="Overview Kind object type, on a par with enum, class, struct Actor is a reference type, similar to a class, can inherit from other actors, conforms to protocol, be generics, and be used with generics Difference is actor has isolation domain, which helps in protecting mutable state, prevent data races Actor&rsquo;s code run on background by default Actor Isolation If an actor instance have mutable property (var), can only be modified on self Can access actor&rsquo;s property, but this access is asynchronous, must use await Can call actor&rsquo;s method, but this access is asynchronous, must use await (even if it is not an async method) Why await❓ To make sure, no other code belonging to the same actor can start, solves the problem of simultaneous access." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tinhpv.github.io/posts/ios/concurrency-with-actor-swift/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-21T00:41:36+07:00" />
<meta property="article:modified_time" content="2022-08-21T00:41:36+07:00" />

 <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Concurrency using Actor"/>
<meta name="twitter:description" content="Overview Kind object type, on a par with enum, class, struct Actor is a reference type, similar to a class, can inherit from other actors, conforms to protocol, be generics, and be used with generics Difference is actor has isolation domain, which helps in protecting mutable state, prevent data races Actor&rsquo;s code run on background by default Actor Isolation If an actor instance have mutable property (var), can only be modified on self Can access actor&rsquo;s property, but this access is asynchronous, must use await Can call actor&rsquo;s method, but this access is asynchronous, must use await (even if it is not an async method) Why await❓ To make sure, no other code belonging to the same actor can start, solves the problem of simultaneous access."/>
     
  <link
    rel="stylesheet"
    href="https://tinhpv.github.io/css/styles.607f8047f9023a5e79d9e59d62ace551bf6fe2c238e827268ba96cbbbcc1666aec3fde7855a827a5c71a6ce725fb880a8c57ffd24c22383c5bd3daa40718d7d8.css"
    integrity="sha512-YH&#43;AR/kCOl552eWdYqzlUb9v4sI46Ccmi6lsu7zBZmrsP954VagnpccabOcl&#43;4gKjFf/0kwiODxb09qkBxjX2A=="
  />

  
   
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
   
<link rel="icon" type="image/png" href="https://tinhpv.github.io/images/favicon.ico" />
   
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-CXVWF0BZ3E', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">All posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/categories">Categories</a></li>
         
        <li><a href="/categories/ios/"> iOS</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://tinhpv.github.io/posts/ios/concurrency-with-async-await/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://tinhpv.github.io/posts/ios/memory-management/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&text=Concurrency%20using%20Actor" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&title=Concurrency%20using%20Actor" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&is_video=false&description=Concurrency%20using%20Actor" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Concurrency%20using%20Actor&body=Check out this article: https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&title=Concurrency%20using%20Actor" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&title=Concurrency%20using%20Actor" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&name=Concurrency%20using%20Actor&description=Overview%20Kind%20object%20type%2c%20on%20a%20par%20with%20enum%2c%20class%2c%20struct%20Actor%20is%20a%20reference%20type%2c%20similar%20to%20a%20class%2c%20can%20inherit%20from%20other%20actors%2c%20conforms%20to%20protocol%2c%20be%20generics%2c%20and%20be%20used%20with%20generics%20Difference%20is%20actor%20has%20isolation%20domain%2c%20which%20helps%20in%20protecting%20mutable%20state%2c%20prevent%20data%20races%20Actor%26rsquo%3bs%20code%20run%20on%20background%20by%20default%20Actor%20Isolation%20If%20an%20actor%20instance%20have%20mutable%20property%20%28var%29%2c%20can%20only%20be%20modified%20on%20self%20Can%20access%20actor%26rsquo%3bs%20property%2c%20but%20this%20access%20is%20asynchronous%2c%20must%20use%20await%20Can%20call%20actor%26rsquo%3bs%20method%2c%20but%20this%20access%20is%20asynchronous%2c%20must%20use%20await%20%28even%20if%20it%20is%20not%20an%20async%20method%29%20Why%20await%e2%9d%93%20To%20make%20sure%2c%20no%20other%20code%20belonging%20to%20the%20same%20actor%20can%20start%2c%20solves%20the%20problem%20of%20simultaneous%20access." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&t=Concurrency%20using%20Actor" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#actor-isolation">Actor Isolation</a></li>
      </ul>
    </li>
    <li><a href="#sendable-types"><code>Sendable</code> types</a></li>
    <li><a href="#main-actor">Main Actor</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Concurrency using Actor
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2022-08-21 00:41:36 &#43;0700 &#43;07" itemprop="datePublished">2022-08-21</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          5 minute read
        </div>
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/ios">ios</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/multithread" rel="tag">multithread</a>
            
             ,  
            <a class="tag-link" href="/tags/concurrency" rel="tag">concurrency</a>
            
             ,  
            <a class="tag-link" href="/tags/actor" rel="tag">actor</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h3 id="overview">Overview</h3>
<ul>
<li>Kind object type, on a par with <code>enum</code>, <code>class</code>, <code>struct</code></li>
<li>Actor is a <strong>reference type</strong>, similar to a <code>class</code>, can inherit from other actors, conforms to protocol, be generics, and be used with generics</li>
<li>Difference is actor has <em>isolation domain</em>, which helps in protecting mutable state, prevent data races</li>
<li>Actor&rsquo;s code run on <em>background</em> by default</li>
</ul>
<h3 id="actor-isolation">Actor Isolation</h3>
<ol>
<li>If an actor instance have <em>mutable property</em> (<code>var</code>), can only be modified on <code>self</code></li>
<li>Can access actor&rsquo;s <strong>property</strong>, but this access is <em>asynchronous</em>, must use <code>await</code></li>
<li>Can call actor&rsquo;s <strong>method</strong>, but this access is <em>asynchronous</em>, must use <code>await</code> (even if it is not an <code>async</code> method)</li>
</ol>
<p>Why <code>await</code>❓ To make sure, no other code belonging to the same actor can start, solves the problem of simultaneous access. With an actor, there is no simultaneous access. Access to an actor is serialized. ✅</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>actor BankAccount {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">accountNumber</span>: <span style="color:#8be9fd;font-style:italic">Int</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    <span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#8be9fd;font-style:italic">balance</span>: <span style="color:#8be9fd;font-style:italic">Double</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    <span style="color:#8be9fd;font-style:italic">init</span>(accountNumber: <span style="color:#8be9fd;font-style:italic">Int</span>, balance: <span style="color:#8be9fd;font-style:italic">Double</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>        <span style="color:#ff79c6">self</span>.accountNumber = accountNumber
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>        <span style="color:#ff79c6">self</span>.balance = balance
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">accountA</span> = BankAccount(accountNumber: <span style="color:#bd93f9">1</span>, balance: <span style="color:#bd93f9">100.0</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>print(accountA.accountNumber) <span style="color:#6272a4">// ✅ constant value, so can be directly accessible</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>print(accountA.balance) <span style="color:#6272a4">// ⛔️ mutable property, have to put await</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>Task {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    print(await accountA.balance) <span style="color:#6272a4">// ✅ it&#39;s legal now</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>accountA.balance = <span style="color:#bd93f9">200.0</span> <span style="color:#6272a4">// ⛔️ this is illegal, will trigger an error as cannot modify not on self</span>
</span></span></code></pre></div><p>Let&rsquo;s add a method to the actor 👍
See, in <code>transfer(amount:to)</code>, we reference to an actor → this is called <code>cross-actor reference</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#8be9fd;font-style:italic">extension</span> <span style="color:#50fa7b">BankAccount</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    @discardableResult
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">transfer</span>(amount: <span style="color:#8be9fd;font-style:italic">Double</span>, to other: BankAccount) -&gt; <span style="color:#8be9fd;font-style:italic">Bool</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>        <span style="color:#ff79c6">guard</span> amount <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> amount <span style="color:#ff79c6">&lt;=</span> balance <span style="color:#ff79c6">else</span> { <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span> }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>        <span style="color:#ff79c6">self</span>.balance <span style="color:#ff79c6">-=</span> amount <span style="color:#6272a4">// ✅ legal, balance is modified on self</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>        other.balance <span style="color:#ff79c6">+=</span> amount <span style="color:#6272a4">// illegal, not on self ➡️ modified on non-isolated actor instance</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><p><strong>Solution:</strong>  Add new method to the actor, say <code>deposit()</code> that legally modify <code>balance</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#8be9fd;font-style:italic">extension</span> <span style="color:#50fa7b">BankAccount</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">deposite</span>(<span style="color:#ff79c6">_</span> amount: <span style="color:#8be9fd;font-style:italic">Double</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>        <span style="color:#ff79c6">self</span>.balance <span style="color:#ff79c6">+=</span> amount
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    @discardableResult
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">transfer</span>(amount: <span style="color:#8be9fd;font-style:italic">Double</span>, to other: BankAccount) async -&gt; <span style="color:#8be9fd;font-style:italic">Bool</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>        <span style="color:#ff79c6">guard</span> amount <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> amount <span style="color:#ff79c6">&lt;=</span> balance <span style="color:#ff79c6">else</span> { <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span> }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>        <span style="color:#ff79c6">self</span>.balance <span style="color:#ff79c6">-=</span> amount
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>        await other.deposite(amount) <span style="color:#6272a4">// ✅ legal now</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div><p><strong>Another one:</strong> use <code>isolated</code> keyword
<code>isolated</code> will bind method <code>transfer(amount:to)</code> to <code>other</code> isolation domain</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#8be9fd;font-style:italic">extension</span> <span style="color:#50fa7b">BankAccount</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    @discardableResult
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">transfer</span>(amount: <span style="color:#8be9fd;font-style:italic">Double</span>, to other: isolated BankAccount) -&gt; <span style="color:#8be9fd;font-style:italic">Bool</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>        <span style="color:#ff79c6">guard</span> amount <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> amount <span style="color:#ff79c6">&lt;=</span> balance <span style="color:#ff79c6">else</span> { <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span> }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>        <span style="color:#ff79c6">self</span>.balance <span style="color:#ff79c6">-=</span> amount
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>        other.balance <span style="color:#ff79c6">+=</span> amount
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><h2 id="sendable-types"><code>Sendable</code> types</h2>
<ul>
<li>Values of types that conform to <code>Sendable</code> protocol are safe to share accross concurrency domain:
<ul>
<li>value-semantic type (<code>Int</code>, <code>Bool</code>, <code>Double</code>, <code>String</code>&hellip;)</li>
<li>value-semantic collections (<code>[Int]</code>, <code>[Int: String]</code>)</li>
<li>immutable class (only containing constant value <code>let</code>)</li>
<li>class that perform its own synchronization internally</li>
<li>structure or enum contains values of type that is <code>Sendable</code> will implicitly <code>Sendable</code></li>
</ul>
</li>
<li>Actor type <em>implicitly</em> conforms to <code>Sendable</code> protocol, protects its mutable state, actor instances can be safe to share accross concurrency domain.</li>
</ul>
<p><strong>⚠️ Issue with Actor:</strong></p>
<ul>
<li>Add a list of owners to the actor, owner in type of <code>Person</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#6272a4">// This is not implicitly conforming to Sendable</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#6272a4">// Since it is a class - reference type </span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#6272a4">// have a mutable property which can be mutated on multiple threads</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Person</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    <span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#8be9fd;font-style:italic">name</span>: <span style="color:#8be9fd;font-style:italic">String</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">age</span>: <span style="color:#8be9fd;font-style:italic">Int</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    <span style="color:#8be9fd;font-style:italic">init</span>(name: <span style="color:#8be9fd;font-style:italic">String</span>, age: <span style="color:#8be9fd;font-style:italic">Int</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>        <span style="color:#ff79c6">self</span>.name = name
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>        <span style="color:#ff79c6">self</span>.age = age
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>actor BankAccount {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    ...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    <span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#8be9fd;font-style:italic">owners</span>: [Person]
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>    ...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>}
</span></span></code></pre></div><ul>
<li>Add a getter function to return primary owner of the account</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#8be9fd;font-style:italic">extension</span> <span style="color:#50fa7b">BankAccount</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    ...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">primaryOwner</span>() -&gt; Person? {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>        owners.first
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><ul>
<li>Now, time to test&hellip;</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">primaryOwnerOfAccountA</span> = Person(name: <span style="color:#f1fa8c">&#34;Aaron Phan&#34;</span>, age: <span style="color:#bd93f9">24</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">accountA</span> = BankAccount(accountNumber: <span style="color:#bd93f9">1</span>, balance: <span style="color:#bd93f9">100.0</span>, owners: [primaryOwnerOfAccountA])
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>Task {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">primaryOwner</span> = await accountA.primaryOwner() {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>        primaryOwner.name = <span style="color:#f1fa8c">&#34;Phan Vu Tinh&#34;</span> <span style="color:#6272a4">// ⛔️ should be avoid since `name` can be mutated on multiple threads but XCode does not warn it</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>}
</span></span></code></pre></div><p>The problem is that we still can access the actor property (which is not <code>Sendable</code>) and modify one of its properties on multiple thread without any complain</p>
<p>Solution:</p>
<ul>
<li>mark <code>Person</code> as <code>final</code> to stop further inheritance</li>
<li>make it conform to <code>Sendable</code> with <code>@unchecked</code></li>
<li>encapsolate <code>name</code>, create <code>updateName()</code> to update <code>name</code> with serial queue</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#ff79c6">final</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Person</span>: @unchecked Sendable {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#8be9fd;font-style:italic">name</span>: <span style="color:#8be9fd;font-style:italic">String</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">age</span>: <span style="color:#8be9fd;font-style:italic">Int</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">serialQueue</span> = DispatchQueue(label: <span style="color:#f1fa8c">&#34;person.serial.queue&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    <span style="color:#8be9fd;font-style:italic">init</span>(name: <span style="color:#8be9fd;font-style:italic">String</span>, age: <span style="color:#8be9fd;font-style:italic">Int</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>        <span style="color:#ff79c6">self</span>.name = name
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>        <span style="color:#ff79c6">self</span>.age = age
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">updateName</span>(<span style="color:#ff79c6">_</span> name: <span style="color:#8be9fd;font-style:italic">String</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>        serialQueue.sync {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>            <span style="color:#ff79c6">self</span>.name = name
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>}
</span></span></code></pre></div><h2 id="main-actor">Main Actor</h2>
<ul>
<li>Isolate code to main actor, it will run on main thread</li>
<li>How? Use <code>@MainActor</code> directive on:
<ul>
<li><em>property</em> (static/class/instance property) 👉 only be accessed on main thread</li>
<li><em>closure</em>, <em>method</em> (static/class/instance property) 👉 only be called on main thread</li>
<li><em>a type (class, struct, enum)</em> 👉 all of its properties and methods are only accessed only on the main thread.</li>
<li><em>global variable or function</em></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>actor MyActor {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">id</span> = UUID().uuidString
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    @MainActor <span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#8be9fd;font-style:italic">actorProperty</span>: <span style="color:#8be9fd;font-style:italic">String</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    <span style="color:#8be9fd;font-style:italic">init</span>(actorProperty: <span style="color:#8be9fd;font-style:italic">String</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>        <span style="color:#ff79c6">self</span>.actorProperty = actorProperty
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    @MainActor <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">mutateProperty</span>(<span style="color:#ff79c6">_</span> newValue: <span style="color:#8be9fd;font-style:italic">String</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>        <span style="color:#ff79c6">self</span>.actorProperty = newValue
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>print(actor.actorProperty) <span style="color:#6272a4">// ✅ now can be access it on Main thread without `await`</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>actor.mutateProperty(<span style="color:#f1fa8c">&#34;Vietnam&#34;</span>) <span style="color:#6272a4">// ✅ it is legal </span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>actor.actorProperty = <span style="color:#f1fa8c">&#34;Hochiminh city&#34;</span> <span style="color:#6272a4">// ✅ it is legal, can be mutate directly</span>
</span></span></code></pre></div><p>⁉️ <em>Switching context from background thread to main thread for updating UI?</em>
MainActor has an extension</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>@available(macOS <span style="color:#bd93f9">12.0</span>, iOS <span style="color:#bd93f9">15.0</span>, watchOS <span style="color:#bd93f9">8.0</span>, tvOS <span style="color:#bd93f9">15.0</span>, <span style="color:#ff79c6">*</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#8be9fd;font-style:italic">extension</span> <span style="color:#50fa7b">MainActor</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>    <span style="color:#6272a4">/// Execute the given body closure on the main actor.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">run</span>&lt;T&gt;(resultType: T.<span style="color:#ff79c6">Type</span> = T.<span style="color:#ff79c6">self</span>, body: @MainActor @Sendable () <span style="color:#ff79c6">throws</span> -&gt; T) async <span style="color:#ff79c6">rethrows</span> -&gt; T
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><p>Usage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">imgUrl</span> = <span style="color:#f1fa8c">&#34;https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885__480.jpg&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>Task.detached {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    <span style="color:#6272a4">// 🅱️ Run on background thread </span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    <span style="color:#ff79c6">do</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>        <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">data</span> = <span style="color:#ff79c6">try</span> await <span style="color:#ff79c6">self</span>.download(url: URL(string: imgUrl)<span style="color:#ff79c6">!</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>        await MainActor.run {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>        <span style="color:#6272a4">// Ⓜ️ Now, switched to Main thread</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>            <span style="color:#ff79c6">self</span>.image1.image = UIImage(data: data)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    } <span style="color:#ff79c6">catch</span>(<span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#8be9fd;font-style:italic">error</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>        print(error.localizedDescription)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div>
    </div>
  </article>

  
  




  <div class="blog-post-comments">
    
      <div id="cactus-comments-thread">
  <script>
  initComments({
    node: document.getElementById("cactus-comments-thread"),
    defaultHomeserverUrl: 'https:\/\/matrix.cactus.chat:8448',
    serverName: 'cactus.chat',
    siteName: "notebyaaron",
    commentSectionId: "\/posts\/ios\/concurrency-with-actor-swift\/"
  })
</script>
</div>

    
  </div>



  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">All posts</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/categories">Categories</a></li>
         
          <li><a href="/categories/ios/"> iOS</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#actor-isolation">Actor Isolation</a></li>
      </ul>
    </li>
    <li><a href="#sendable-types"><code>Sendable</code> types</a></li>
    <li><a href="#main-actor">Main Actor</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&text=Concurrency%20using%20Actor" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&title=Concurrency%20using%20Actor" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&is_video=false&description=Concurrency%20using%20Actor" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Concurrency%20using%20Actor&body=Check out this article: https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&title=Concurrency%20using%20Actor" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&title=Concurrency%20using%20Actor" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&name=Concurrency%20using%20Actor&description=Overview%20Kind%20object%20type%2c%20on%20a%20par%20with%20enum%2c%20class%2c%20struct%20Actor%20is%20a%20reference%20type%2c%20similar%20to%20a%20class%2c%20can%20inherit%20from%20other%20actors%2c%20conforms%20to%20protocol%2c%20be%20generics%2c%20and%20be%20used%20with%20generics%20Difference%20is%20actor%20has%20isolation%20domain%2c%20which%20helps%20in%20protecting%20mutable%20state%2c%20prevent%20data%20races%20Actor%26rsquo%3bs%20code%20run%20on%20background%20by%20default%20Actor%20Isolation%20If%20an%20actor%20instance%20have%20mutable%20property%20%28var%29%2c%20can%20only%20be%20modified%20on%20self%20Can%20access%20actor%26rsquo%3bs%20property%2c%20but%20this%20access%20is%20asynchronous%2c%20must%20use%20await%20Can%20call%20actor%26rsquo%3bs%20method%2c%20but%20this%20access%20is%20asynchronous%2c%20must%20use%20await%20%28even%20if%20it%20is%20not%20an%20async%20method%29%20Why%20await%e2%9d%93%20To%20make%20sure%2c%20no%20other%20code%20belonging%20to%20the%20same%20actor%20can%20start%2c%20solves%20the%20problem%20of%20simultaneous%20access." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ftinhpv.github.io%2fposts%2fios%2fconcurrency-with-actor-swift%2f&t=Concurrency%20using%20Actor" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Aaron Phan 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">All posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/categories">Categories</a></li>
         
        <li><a href="/categories/ios/"> iOS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
